<!DOCTYPE html>
{% load static %}
{% load cli_browser_tags %}
<html lang="en"{% if user_theme != 'terminal-amber' %} data-theme="{{ user_theme }}"{% endif %}>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}FORTIS AURIS LMS{% endblock %}</title>
    <meta name="csrf-token" content="{{ csrf_token }}">
    <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css">
    <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap-theme.min.css">
    <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="{% static 'css/blog.css' %}">
    <link href="https://fonts.googleapis.com/css2?family=Ubuntu:ital,0,1;wght@300;400;500;700&family=Ubuntu+Mono:ital,0,1;wght@400;700&display=swap" rel="stylesheet">
    {% block extra_css %}{% endblock %}
    
    <!-- Immediate Theme Loader - prevents flash -->
    <script src="{% static 'js/theme-preload.js' %}"></script>
</head>
<body>
    {% csrf_token %}
    <!-- CLI Browser Navigation - Accessible for Links2, w3m, ELinks, Lynx -->
    <noscript>
    <div class="cli-navigation" style="background-color: #f0f0f0; padding: 10px; margin: 10px 0; border: 1px solid #ccc;">
        <h4>CLI Browser Navigation</h4>
        <p><strong>FORTIS AURIS LMS</strong> - Main Navigation:</p>
        <ul style="list-style-type: none; padding: 0; margin: 10px 0;">
            <li style="margin: 5px 0;">
                <a href="{% url 'landing' %}">[HOME]</a> - Main dashboard and course overview
            </li>
            <li style="margin: 5px 0;">
                <a href="{% url 'event_calendar' %}">[CALENDAR]</a> - View all events and schedules
            </li>
            {% if user.is_authenticated %}
                <li style="margin: 5px 0;">
                    <strong>Logged in as: {{ user.username }}</strong>
                </li>
                <li style="margin: 5px 0;">
                    <a href="{% url 'forum_list' %}">[FORUMS]</a> - Discussion forums
                </li>
                <li style="margin: 5px 0;">
                    <a href="{% url 'all_blogs' %}">[BLOGS]</a> - All user blogs
                </li>
                <li style="margin: 5px 0;">
                    <a href="{% url 'my_blog_dashboard' %}">[MY BLOG]</a> - Personal blog management
                </li>
                {% if user.is_staff and user.is_superuser %}
                    <li style="margin: 5px 0;">
                        <a href="/admin/">[ADMIN]</a> - Site administration
                    </li>
                {% else %}
                    {% if user.userprofile.role == 'instructor' %}
                        <li style="margin: 5px 0;">
                            <a href="{% url 'instructor_dashboard' %}">[DASHBOARD]</a> - Instructor control panel
                        </li>
                    {% else %}
                        <li style="margin: 5px 0;">
                            <a href="{% url 'student_dashboard' %}">[DASHBOARD]</a> - Student progress and courses
                        </li>
                    {% endif %}
                {% endif %}
                <li style="margin: 5px 0;">
                    <a href="{% url 'logout' %}">[LOGOUT]</a> - Sign out of system
                </li>
            {% else %}
                <li style="margin: 5px 0;">
                    <a href="{% url 'login' %}">[LOGIN]</a> - Sign in to access courses
                </li>
                <li style="margin: 5px 0;">
                    <a href="{% url 'register' %}">[REGISTER]</a> - Create new account
                </li>
            {% endif %}
        </ul>
        <hr style="margin: 10px 0;">
    </div>
    </noscript>

    <!-- CLI Browser Information Widget -->
    {% cli_browser_info %}

    <div class="page-header">
        <h1><a href="{% url 'landing' %}">âš¡ FORTIS AURIS LMS</a></h1>
        <div class="top-menu">
            <span class="zulu-time">
                ZULU: <span id="watch">--:--:--:---</span>
                <noscript>({{ "now"|date:"H:i:s" }} UTC)</noscript>
            </span>
            <!-- Public Calendar Link - Available to Everyone -->
            <a href="{% url 'event_calendar' %}" class="btn btn-warning"><i class="glyphicon glyphicon-calendar"></i> calendar</a>
            {% if user.is_authenticated %}
                <span>user@lms:~$ whoami â†’ {{ user.username }}</span>
                <a href="{% url 'forum_list' %}" class="btn btn-default">forums</a>
                <a href="{% url 'all_blogs' %}" class="btn btn-default">blogs</a>
                <a href="{% url 'my_blog_dashboard' %}" class="btn btn-default">my blog</a>
                {% if user.is_superuser %}
                    <a href="{% url 'ical_import_export_page' %}" class="btn btn-info" title="Import/Export Calendar Events">ðŸ“… iCal</a>
                {% endif %}
                {% if user.is_staff and user.is_superuser %}
                    <a href="/admin/" class="btn btn-default">admin</a>
                {% else %}
                    {% if user.userprofile.role == 'instructor' %}
                        <a href="{% url 'instructor_dashboard' %}" class="btn btn-default">dashboard</a>
                    {% else %}
                        <a href="{% url 'student_dashboard' %}" class="btn btn-default">dashboard</a>
                    {% endif %}
                {% endif %}
                <a href="{% url 'logout' %}" class="btn btn-default">logout</a>
            {% else %}
                <a href="{% url 'login' %}" class="btn btn-default">login</a>
                <a href="{% url 'register' %}" class="btn btn-default">register</a>
            {% endif %}
        </div>
    </div>

    {% block content %}
    {% endblock %}



    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
    <script src="//maxcdn.bootstrapcdn.com/bootstrap/3.2.0/js/bootstrap.min.js"></script>
    
    <!-- MathJax for Math Equation Rendering -->
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>
        window.MathJax = {
            tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']],
                displayMath: [['$$', '$$'], ['\\[', '\\]']],
                processEscapes: true,
                processEnvironments: true
            },
            options: {
                skipHtmlTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code'],
                ignoreHtmlClass: 'tex2jax_ignore'
            }
        };
    </script>
    
    <script src="{% static 'js/theme-switcher.js' %}"></script>
    
    <!-- ZULU/GMT Time Clock -->
    <script>
        function ActualTime() {
            var now = new Date();
            // Get UTC time components
            var hours = now.getUTCHours();
            var minutes = now.getUTCMinutes();
            var seconds = now.getUTCSeconds();
            var milliseconds = now.getUTCMilliseconds();
            
            minutes = actualizeTime(minutes);
            seconds = actualizeTime(seconds);
            // Format milliseconds to 3 digits
            milliseconds = String(milliseconds).padStart(3, '0');
            
            document.getElementById('watch').innerHTML =
                hours + ":" + minutes + ":" + seconds + ":" + milliseconds;
            var timer = setTimeout(ActualTime, 1);
        }
        
        function actualizeTime(i) {
            if (i < 10) {i = "0" + i}
            return i;
        }
        
        // Start the clock when the page loads
        document.addEventListener('DOMContentLoaded', function() {
            ActualTime();
        });

    </script>
    
    {% block extra_js %}{% endblock %}
</body>
</html>