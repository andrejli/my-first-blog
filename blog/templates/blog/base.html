<!DOCTYPE html>
{% load static %}
{% load compress %}
{% load cli_browser_tags %}
{% load csp_tags %}
{% load cache %}
<html lang="en" data-theme="{{ user_theme }}"{% if user_theme == 'terminal-amber' %} data-default-theme="true"{% endif %}>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}FORTIS AURIS LMS{% endblock %}</title>
    <meta name="csrf-token" content="{{ csrf_token }}">
    
    <!-- External CDN resources (not compressed) -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap-theme.min.css">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@300;400;500;700&family=Ubuntu+Mono:wght@400;700&display=swap" rel="stylesheet">
    
    <!-- Local CSS (compressed and minified) -->
    {% compress css %}
    <link rel="stylesheet" href="{% static 'css/blog.css' %}">
    {% endcompress %}
    
    {% block extra_css %}{% endblock %}
    
    <!-- Immediate Theme Loader - prevents flash -->
    {% compress js %}
    <script src="{% static 'js/theme-preload.js' %}"></script>
    {% endcompress %}
</head>
<body>
    {% csrf_token %}
    <!-- CLI Browser Navigation - Accessible for Links2, w3m, ELinks, Lynx -->
    <noscript>
    {% cache 3600 cli_navigation user.is_authenticated user.is_staff user.is_superuser %}
    <div class="cli-navigation" style="background-color: #f0f0f0; padding: 10px; margin: 10px 0; border: 1px solid #ccc;">
        <h4>CLI Browser Navigation</h4>
        <p><strong>FORTIS AURIS LMS</strong> - Main Navigation:</p>
        <ul style="list-style-type: none; padding: 0; margin: 10px 0;">
            <li style="margin: 5px 0;">
                <a href="{% url 'landing' %}">[HOME]</a> - Main dashboard and course overview
            </li>
            <li style="margin: 5px 0;">
                <a href="{% url 'event_calendar' %}">[CALENDAR]</a> - View all events and schedules
            </li>
            {% if user.is_authenticated %}
                <li style="margin: 5px 0;">
                    <strong>Logged in as: {{ user.username }}</strong>
                </li>
                <li style="margin: 5px 0;">
                    <a href="{% url 'forum_list' %}">[FORUMS]</a> - Discussion forums
                </li>
                <li style="margin: 5px 0;">
                    <a href="{% url 'all_blogs' %}">[BLOGS]</a> - All user blogs
                </li>
                <li style="margin: 5px 0;">
                    <a href="{% url 'my_blog_dashboard' %}">[MY BLOG]</a> - Personal blog management
                </li>
                {% if user.is_staff and user.is_superuser %}
                    <li style="margin: 5px 0;">
                        <a href="/admin/">[ADMIN]</a> - Site administration
                    </li>
                    <li style="margin: 5px 0;">
                        <a href="{% url 'quarantine_dashboard' %}">[QUARANTINE]</a> - Content moderation dashboard
                    </li>
                    <li style="margin: 5px 0;">
                        <a href="{% url 'secret_chamber:dashboard' %}">[SECRET CHAMBER]</a> - Admin decision system (confidential)
                    </li>
                {% else %}
                    {% if user.userprofile.role == 'instructor' %}
                        <li style="margin: 5px 0;">
                            <a href="{% url 'instructor_dashboard' %}">[DASHBOARD]</a> - Instructor control panel
                        </li>
                    {% else %}
                        <li style="margin: 5px 0;">
                            <a href="{% url 'student_dashboard' %}">[DASHBOARD]</a> - Student progress and courses
                        </li>
                    {% endif %}
                {% endif %}
                <li style="margin: 5px 0;">
                    <a href="{% url 'logout' %}">[LOGOUT]</a> - Sign out of system
                </li>
            {% else %}
                <li style="margin: 5px 0;">
                    <a href="{% url 'login' %}">[LOGIN]</a> - Sign in to access courses
                </li>
                <li style="margin: 5px 0;">
                    <a href="{% url 'register' %}">[REGISTER]</a> - Create new account
                </li>
            {% endif %}
        </ul>
        <hr style="margin: 10px 0;">
    </div>
    {% endcache %}
    </noscript>

    <!-- CLI Browser Information Widget -->
    {% cli_browser_info %}

    <div class="page-header">
        <h1><a href="{% url 'landing' %}">âš¡ FORTIS AURIS LMS</a></h1>
        {% cache 600 top_menu user.is_authenticated user.id user.is_staff user.is_superuser %}
        <div class="top-menu">
            <span class="zulu-time">
                CET: <span id="watch">--:--:--:---</span>
                <noscript>({{ "now"|date:"H:i:s" }} CET)</noscript>
            </span>
            <!-- Public Calendar Link - Available to Everyone -->
            <a href="{% url 'event_calendar' %}" class="btn btn-warning"><i class="glyphicon glyphicon-calendar"></i> calendar</a>
            {% if user.is_authenticated %}
                <span>user@lms:~$ whoami â†’ {{ user.username }}</span>
                <a href="{% url 'forum_list' %}" class="btn btn-default">forums</a>
                <a href="{% url 'all_blogs' %}" class="btn btn-default">blogs</a>
                <a href="{% url 'my_blog_dashboard' %}" class="btn btn-default">my blog</a>
                {% if user.is_superuser %}
                    <a href="{% url 'ical_import_export_page' %}" class="btn btn-info" title="Import/Export Calendar Events">ðŸ“… iCal</a>
                    <a href="{% url 'secret_chamber:dashboard' %}" class="btn btn-danger" title="Secret Chamber - Admin Decision System" style="background: linear-gradient(45deg, #333, #555); border-color: #00ff88; color: #00ff88; font-size: 14px; padding: 6px 10px;">ï¿½</a>
                {% endif %}
                {% if user.is_staff and user.is_superuser %}
                    <a href="/admin/" class="btn btn-default">admin</a>
                {% else %}
                    {% if user.userprofile.role == 'instructor' %}
                        <a href="{% url 'instructor_dashboard' %}" class="btn btn-default">dashboard</a>
                    {% else %}
                        <a href="{% url 'student_dashboard' %}" class="btn btn-default">dashboard</a>
                    {% endif %}
                {% endif %}
                <a href="{% url 'logout' %}" class="btn btn-default">logout</a>
            {% else %}
                <a href="{% url 'login' %}" class="btn btn-default">login</a>
                <a href="{% url 'register' %}" class="btn btn-default">register</a>
            {% endif %}
        </div>
        {% endcache %}
    </div>

    {% block content %}
    {% endblock %}



    
    <!-- External CDN resources (not compressed) -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/js/bootstrap.min.js"></script>
    
    <!-- MathJax for Math Equation Rendering -->
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script {% csp_script_attrs %}>
        window.MathJax = {
            tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']],
                displayMath: [['$$', '$$'], ['\\[', '\\]']],
                processEscapes: true,
                processEnvironments: true
            },
            options: {
                skipHtmlTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code'],
                ignoreHtmlClass: 'tex2jax_ignore'
            }
        };
    </script>
    
    <!-- Local JavaScript (compressed and minified) -->
    {% compress js %}
    <script src="{% static 'js/theme-switcher.js' %}"></script>
    <script src="{% static 'js/cet-clock.js' %}"></script>
    {% endcompress %}    {% block extra_js %}{% endblock %}
</body>
</html>