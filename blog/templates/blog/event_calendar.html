{% extends 'blog/base.html' %}

{% block title %}FORTIS AURIS LMS - Event Calendar{% endblock %}

{% block content %}
<div class="container-fluid mt-4" style="padding-left: 2rem;">
    <div class="row">
        <div class="col-12">
            <h2 class="mb-4">
                <i class="fas fa-calendar-alt"></i> Event Calendar
                <div class="float-right">
                    {% if user.is_superuser %}
                    <a href="{% url 'ical_import_export_page' %}" class="btn btn-info btn-sm mr-2" title="Import/Export Calendar Events">
                        <i class="fas fa-upload"></i> <i class="fas fa-download"></i> iCal Import/Export
                    </a>
                    {% endif %}
                    {% if user.is_staff %}
                    <a href="{% url 'event_management' %}" class="btn btn-primary btn-sm">
                        <i class="fas fa-cog"></i> Manage Events
                    </a>
                    {% endif %}
                </div>
            </h2>
        </div>
    </div>

    <!-- Calendar Navigation and View Selector -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="card">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-center flex-wrap">
                        <!-- View Selector -->
                        <div class="mb-2 mb-md-0">
                            <div class="btn-group" role="group" aria-label="Calendar View">
                                <a href="?view=month&year={{ year }}&month={{ month }}" 
                                   class="btn btn-sm {% if view_mode == 'month' %}btn-primary{% else %}btn-outline-primary{% endif %}">
                                    Month
                                </a>
                                <a href="?view=week&year={{ current_date.year }}&month={{ current_date.month }}&day={{ current_date.day }}" 
                                   class="btn btn-sm {% if view_mode == 'week' %}btn-primary{% else %}btn-outline-primary{% endif %}">
                                    Week
                                </a>
                                <a href="?view=day&year={{ current_date.year }}&month={{ current_date.month }}&day={{ current_date.day }}" 
                                   class="btn btn-sm {% if view_mode == 'day' %}btn-primary{% else %}btn-outline-primary{% endif %}">
                                    Day
                                </a>
                            </div>
                        </div>

                        <!-- Current Period Title -->
                        <div class="text-center mb-2 mb-md-0">
                            <h5 class="card-title mb-0">
                                {% if view_mode == 'month' %}
                                    {{ current_month|date:"F Y" }}
                                {% elif view_mode == 'week' %}
                                    Week of {{ week_days.0.date|date:"M j" }} - {{ week_days.6.date|date:"M j, Y" }}
                                {% else %}
                                    {{ current_date|date:"l, F j, Y" }}
                                {% endif %}
                            </h5>
                        </div>

                        <!-- Navigation Controls -->
                        <div>
                            {% if view_mode == 'month' %}
                                <a href="?view=month&month={{ prev_obj.month }}&year={{ prev_obj.year }}" class="btn btn-outline-secondary btn-sm">
                                    <i class="fas fa-chevron-left"></i> Previous
                                </a>
                                <a href="?view=month&month={{ today.month }}&year={{ today.year }}" class="btn btn-outline-primary btn-sm">
                                    Today
                                </a>
                                <a href="?view=month&month={{ next_obj.month }}&year={{ next_obj.year }}" class="btn btn-outline-secondary btn-sm">
                                    Next <i class="fas fa-chevron-right"></i>
                                </a>
                            {% elif view_mode == 'week' %}
                                <a href="?view=week&year={{ prev_obj.year }}&month={{ prev_obj.month }}&day={{ prev_obj.day }}" class="btn btn-outline-secondary btn-sm">
                                    <i class="fas fa-chevron-left"></i> Previous Week
                                </a>
                                <a href="?view=week&year={{ today.year }}&month={{ today.month }}&day={{ today.day }}" class="btn btn-outline-primary btn-sm">
                                    This Week
                                </a>
                                <a href="?view=week&year={{ next_obj.year }}&month={{ next_obj.month }}&day={{ next_obj.day }}" class="btn btn-outline-secondary btn-sm">
                                    Next Week <i class="fas fa-chevron-right"></i>
                                </a>
                            {% else %}
                                <a href="?view=day&year={{ prev_obj.year }}&month={{ prev_obj.month }}&day={{ prev_obj.day }}" class="btn btn-outline-secondary btn-sm">
                                    <i class="fas fa-chevron-left"></i> Previous Day
                                </a>
                                <a href="?view=day&year={{ today.year }}&month={{ today.month }}&day={{ today.day }}" class="btn btn-outline-primary btn-sm">
                                    Today
                                </a>
                                <a href="?view=day&year={{ next_obj.year }}&month={{ next_obj.month }}&day={{ next_obj.day }}" class="btn btn-outline-secondary btn-sm">
                                    Next Day <i class="fas fa-chevron-right"></i>
                                </a>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="row">
        <!-- Calendar Grid -->
        <div class="col-xs-12 col-sm-12 col-md-8 col-lg-8">
            <div class="card">
                <div class="card-body p-0">
                    
                    {% if view_mode == 'month' %}
                    <!-- Month View -->
                    <div class="table-responsive">
                        <table class="table table-bordered calendar-table mb-0">
                            <!-- Calendar Header -->
                            <thead class="calendar-header">
                                <tr>
                                    <th class="text-center calendar-weekday">Sunday</th>
                                    <th class="text-center calendar-weekday">Monday</th>
                                    <th class="text-center calendar-weekday">Tuesday</th>
                                    <th class="text-center calendar-weekday">Wednesday</th>
                                    <th class="text-center calendar-weekday">Thursday</th>
                                    <th class="text-center calendar-weekday">Friday</th>
                                    <th class="text-center calendar-weekday">Saturday</th>
                                </tr>
                            </thead>
                            
                            <!-- Calendar Body -->
                            <tbody>
                                {% for week in calendar_weeks %}
                                <tr class="calendar-week">
                                    {% for day in week %}
                                    <td class="calendar-day
                                        {% if day.is_today %}today-highlight{% endif %}
                                        {% if not day.is_current_month %}other-month{% endif %}">
                                        <div class="day-container">
                                            <div class="day-number">
                                                {% if day.day %}{{ day.day }}{% endif %}
                                            </div>
                                            <div class="day-events">
                                                {% for event in day.events %}
                                                <div class="calendar-event event-{{ event.event_type }}" 
                                                     title="{{ event.title }} - {{ event.description|truncatechars:50 }}{% if event.has_poster %} - Has Poster{% endif %}{% if event.has_zoom_info %} - Has Zoom Link{% endif %}"
                                                     data-toggle="tooltip" 
                                                     data-placement="top"
                                                     data-html="true"
                                                     data-title="<strong>{{ event.title }}</strong><br>{{ event.get_event_type_display }}<br>{{ event.start_date|date:'M j, Y H:i' }}{% if event.has_poster %}<br><i class='fas fa-image'></i> Poster Available{% endif %}{% if event.has_zoom_info %}<br><i class='fas fa-video'></i> {{ event.get_zoom_display_text }}{% endif %}"
                                                     {% if event.has_poster %}data-poster-url="{{ event.get_poster_url }}"{% endif %}>
                                                    <i class="fa fa-circle event-dot"></i>
                                                    {% if event.has_poster %}
                                                    <i class="fas fa-image poster-indicator" title="Has Poster"></i>
                                                    {% endif %}
                                                    {% if event.has_zoom_info %}
                                                    <i class="fas fa-video zoom-indicator" title="{{ event.get_zoom_display_text }}"></i>
                                                    {% endif %}
                                                    <span class="event-text">
                                                        {% if event.all_day %}
                                                            {{ event.title|truncatechars:28 }}
                                                        {% else %}
                                                            <span class="event-time">{{ event.start_date|date:"H:i" }}</span>
                                                            {{ event.title|truncatechars:20 }}
                                                        {% endif %}
                                                    </span>
                                                </div>
                                                {% endfor %}
                                            </div>
                                        </div>
                                    </td>
                                    {% endfor %}
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                    
                    {% elif view_mode == 'week' %}
                    <!-- Week View -->
                    <div class="week-view">
                        <div class="table-responsive">
                            <table class="table table-bordered week-table mb-0">
                                <thead class="calendar-header">
                                    <tr>
                                        {% for day in week_days %}
                                        <th class="text-center week-day-header {% if day.is_today %}today-highlight{% endif %}">
                                            <div class="week-day-title">{{ day.weekday_short }}</div>
                                            <div class="week-day-number">{{ day.day }}</div>
                                        </th>
                                        {% endfor %}
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr class="week-events-row">
                                        {% for day in week_days %}
                                        <td class="week-day-cell {% if day.is_today %}today-highlight{% endif %}">
                                            <div class="week-day-events">
                                                {% for event in day.events %}
                                                <div class="week-event event-{{ event.event_type }}"
                                                     title="{{ event.title }} - {{ event.description|truncatechars:50 }}{% if event.has_poster %} - Has Poster{% endif %}{% if event.has_zoom_info %} - Has Zoom Link{% endif %}"
                                                     data-toggle="tooltip" 
                                                     data-placement="top"
                                                     data-html="true"
                                                     data-title="<strong>{{ event.title }}</strong><br>{{ event.get_event_type_display }}<br>{{ event.start_date|date:'M j, Y H:i' }}{% if event.has_poster %}<br><i class='fas fa-image'></i> Poster Available{% endif %}{% if event.has_zoom_info %}<br><i class='fas fa-video'></i> {{ event.get_zoom_display_text }}{% endif %}"
                                                     {% if event.has_poster %}data-poster-url="{{ event.get_poster_url }}"{% endif %}>
                                                    {% if event.all_day %}
                                                        <div class="event-all-day">
                                                            <i class="fa fa-circle event-dot"></i>
                                                            {% if event.has_poster %}<i class="fas fa-image poster-indicator" title="Has Poster"></i>{% endif %}
                                                            {% if event.has_zoom_info %}<i class="fas fa-video zoom-indicator" title="{{ event.get_zoom_display_text }}"></i>{% endif %}
                                                            {{ event.title }}
                                                        </div>
                                                    {% else %}
                                                        <div class="event-timed">
                                                            <span class="event-time">{{ event.start_date|date:"H:i" }}</span>
                                                            {% if event.has_poster %}<i class="fas fa-image poster-indicator" title="Has Poster"></i>{% endif %}
                                                            {% if event.has_zoom_info %}<i class="fas fa-video zoom-indicator" title="{{ event.get_zoom_display_text }}"></i>{% endif %}
                                                            {{ event.title }}
                                                        </div>
                                                    {% endif %}
                                                </div>
                                                {% endfor %}
                                            </div>
                                        </td>
                                        {% endfor %}
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                    
                    {% else %}
                    <!-- Day View -->
                    <div class="day-view">
                        <!-- All Day Events -->
                        {% if all_day_events %}
                        <div class="all-day-section">
                            <div class="all-day-header">
                                <h6>All Day Events</h6>
                            </div>
                            <div class="all-day-events">
                                {% for event in all_day_events %}
                                <div class="day-event event-{{ event.event_type }}"
                                     title="{{ event.title }} - {{ event.description|truncatechars:100 }}{% if event.has_poster %} - Has Poster{% endif %}{% if event.has_zoom_info %} - Has Zoom Link{% endif %}"
                                     data-toggle="tooltip" 
                                     data-placement="right"
                                     data-html="true"
                                     {% if event.has_poster %}data-poster-url="{{ event.get_poster_url }}"{% endif %}>
                                    <i class="fa fa-circle event-dot"></i>
                                    {% if event.has_poster %}<i class="fas fa-image poster-indicator" title="Has Poster"></i>{% endif %}
                                    {% if event.has_zoom_info %}<i class="fas fa-video zoom-indicator" title="{{ event.get_zoom_display_text }}"></i>{% endif %}
                                    <strong>{{ event.title }}</strong>
                                    <small class="text-muted">{{ event.get_event_type_display }}</small>
                                </div>
                                {% endfor %}
                            </div>
                        </div>
                        {% endif %}
                        
                        <!-- Hourly Schedule -->
                        <div class="hourly-schedule">
                            <div class="table-responsive">
                                <table class="table table-bordered day-table mb-0">
                                    <tbody>
                                        {% for hour_block in day_hours %}
                                        <tr class="hour-row">
                                            <td class="hour-label">
                                                <span class="hour-time">{{ hour_block.hour_24 }}</span>
                                            </td>
                                            <td class="hour-events">
                                                {% for event in hour_block.events %}
                                                <div class="day-event event-{{ event.event_type }}"
                                                     title="{{ event.title }} - {{ event.description|truncatechars:100 }}{% if event.has_poster %} - Has Poster{% endif %}{% if event.has_zoom_info %} - Has Zoom Link{% endif %}"
                                                     data-toggle="tooltip" 
                                                     data-placement="right"
                                                     data-html="true"
                                                     {% if event.has_poster %}data-poster-url="{{ event.get_poster_url }}"{% endif %}>
                                                    <span class="event-time">
                                                        {{ event.start_date|date:"H:i" }}
                                                        {% if event.end_date %} - {{ event.end_date|date:"H:i" }}{% endif %}
                                                    </span>
                                                    {% if event.has_poster %}<i class="fas fa-image poster-indicator" title="Has Poster"></i>{% endif %}
                                                    {% if event.has_zoom_info %}<i class="fas fa-video zoom-indicator" title="{{ event.get_zoom_display_text }}"></i>{% endif %}
                                                    <strong>{{ event.title }}</strong>
                                                    <small class="text-muted">{{ event.get_event_type_display }}</small>
                                                </div>
                                                {% endfor %}
                                            </td>
                                        </tr>
                                        {% endfor %}
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                    {% endif %}
                    
                </div>
            </div>
        </div>

        <!-- Events Sidebar -->
        <div class="col-xs-12 col-sm-12 col-md-4 col-lg-4">
            <!-- Today's Events -->
            <div class="card mb-4">
                <div class="card-header">
                    <h6 class="mb-0"><i class="fas fa-clock"></i> Today's Events</h6>
                </div>
                <div class="card-body">
                    {% if todays_events %}
                        {% for event in todays_events %}
                        <div class="event-item mb-3">
                            <div class="d-flex justify-content-between">
                                <strong class="event-title">{{ event.title }}</strong>
                                <span class="badge badge-{{ event.priority }}">{{ event.get_priority_display }}</span>
                            </div>
                            {% if not event.all_day %}
                            <small class="text-muted">
                                <i class="fas fa-clock"></i> 
                                {{ event.start_date|date:"H:i" }}
                                {% if event.end_date %} - {{ event.end_date|date:"H:i" }}{% endif %}
                            </small>
                            {% endif %}
                            <small class="text-muted">
                                <i class="fas fa-tag"></i> {{ event.get_event_type_display }}
                                {% if event.visibility == 'public' %}
                                | <i class="fas fa-globe"></i> Public
                                {% else %}
                                | <i class="fas fa-lock"></i> Registered Only
                                {% endif %}
                            </small>
                            {% if event.description %}
                            <p class="event-description mt-1">{{ event.description|truncatechars:100 }}</p>
                            {% endif %}
                            
                            <!-- Lesson Link -->
                            {% if event.has_lesson_link %}
                            <div class="event-lesson-link mt-2">
                                {% if event.get_lesson_url %}
                                <a href="{{ event.get_lesson_url }}" class="btn btn-sm btn-outline-info">
                                    <i class="fas fa-external-link-alt"></i> Go to Lesson: {{ event.get_lesson_display }}
                                </a>
                                {% else %}
                                <span class="text-muted small">
                                    <i class="fas fa-link"></i> Linked: {{ event.get_lesson_display }}
                                    <small class="text-warning">(lesson not found)</small>
                                </span>
                                {% endif %}
                            </div>
                            {% endif %}
                            
                            <!-- Event Files (without poster thumbnails) -->
                            {% if event.has_materials %}
                            <div class="event-files mt-2">
                                <a href="{{ event.get_materials_url }}" class="btn btn-sm btn-outline-secondary" target="_blank">
                                    <i class="fas fa-file-pdf"></i> Materials
                                </a>
                            </div>
                            {% endif %}
                        </div>
                        {% endfor %}
                    {% else %}
                        <p class="text-muted">No events today.</p>
                    {% endif %}
                </div>
            </div>

            <!-- Upcoming Events -->
            <div class="card mb-4">
                <div class="card-header">
                    <h6 class="mb-0"><i class="fas fa-calendar-plus"></i> Upcoming Events</h6>
                </div>
                <div class="card-body">
                    {% if upcoming_events %}
                        {% for event in upcoming_events %}
                        <div class="event-item mb-3">
                            <div class="d-flex justify-content-between">
                                <strong class="event-title">{{ event.title }}</strong>
                                <small class="text-muted">{{ event.start_date|date:"M j" }}</small>
                            </div>
                            <small class="text-muted">
                                <i class="fas fa-tag"></i> {{ event.get_event_type_display }}
                                {% if event.course %}
                                | <i class="fas fa-book"></i> {{ event.course.title }}
                                {% endif %}
                                {% if event.visibility == 'public' %}
                                | <i class="fas fa-globe"></i> Public
                                {% else %}
                                | <i class="fas fa-lock"></i> Registered Only
                                {% endif %}
                            </small>
                            {% if event.description %}
                            <p class="event-description mt-1">{{ event.description|truncatechars:80 }}</p>
                            {% endif %}
                            
                            <!-- Lesson Link -->
                            {% if event.has_lesson_link %}
                            <div class="event-lesson-link mt-2">
                                {% if event.get_lesson_url %}
                                <a href="{{ event.get_lesson_url }}" class="btn btn-sm btn-outline-info">
                                    <i class="fas fa-external-link-alt"></i> {{ event.get_lesson_display|truncatechars:25 }}
                                </a>
                                {% else %}
                                <span class="text-muted small">
                                    <i class="fas fa-link"></i> {{ event.get_lesson_display|truncatechars:30 }}
                                    <small class="text-warning">(not found)</small>
                                </span>
                                {% endif %}
                            </div>
                            {% endif %}
                            
                            <!-- Event Files (without poster thumbnails) -->
                            {% if event.has_materials %}
                            <div class="event-files mt-2">
                                <a href="{{ event.get_materials_url }}" class="btn btn-sm btn-outline-secondary" target="_blank">
                                    <i class="fas fa-file-pdf"></i> Materials
                                </a>
                            </div>
                            {% endif %}
                        </div>
                        {% endfor %}
                    {% else %}
                        <p class="text-muted">No upcoming events.</p>
                    {% endif %}
                </div>
            </div>

            <!-- Event Types Legend -->
            <div class="card">
                <div class="card-header">
                    <h6 class="mb-0"><i class="fas fa-info-circle"></i> Event Types</h6>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-6">
                            <small><i class="fas fa-circle text-primary"></i> General</small><br>
                            <small><i class="fas fa-circle text-danger"></i> Deadline</small><br>
                            <small><i class="fas fa-circle text-warning"></i> Exam</small><br>
                            <small><i class="fas fa-circle text-success"></i> Holiday</small>
                        </div>
                        <div class="col-6">
                            <small><i class="fas fa-circle text-secondary"></i> Maintenance</small><br>
                            <small><i class="fas fa-circle text-info"></i> Meeting</small><br>
                            <small><i class="fas fa-circle text-purple"></i> Workshop</small><br>
                            <small><i class="fas fa-circle text-dark"></i> Announcement</small>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
/* Calendar Container Spacing */
.container-fluid {
    padding-left: 2rem !important;
    padding-right: 1rem !important;
}

/* Calendar Table Styling */
.calendar-table {
    border-collapse: separate !important;
    border-spacing: 0;
    background-color: var(--primary-bg, #000000);
    color: var(--primary-color, #32cd32);
    width: 100%;
    max-width: 100%;
    table-layout: fixed; /* Prevent table from expanding beyond container */
}

.calendar-header th {
    background-color: var(--secondary-bg, #0f0f0f);
    color: var(--secondary-color, #ffc107);
    border: 1px solid var(--border-color, #32cd32);
    padding: 10px 5px;
    font-weight: bold;
    font-size: 1.1rem;
    text-align: center;
}

.calendar-day {
    height: 130px;
    width: 14.28%; /* 100% / 7 days */
    max-width: 14.28%;
    min-width: 100px; /* Minimum width for readability */
    vertical-align: top;
    padding: 0;
    border: 1px solid var(--border-color, #32cd32);
    background-color: var(--primary-bg, #000000);
    position: relative;
    word-wrap: break-word;
    overflow-wrap: break-word;
}

.calendar-day.today-highlight {
    background-color: var(--secondary-bg, #0f0f0f);
    box-shadow: inset 0 0 5px var(--secondary-color, #ffc107);
}

.calendar-day.other-month {
    background-color: #111111;
    opacity: 0.5;
}

.day-container {
    height: 100%;
    padding: 5px;
    display: flex;
    flex-direction: column;
}

.day-number {
    font-weight: bold;
    font-size: 1.2rem;
    color: var(--primary-color, #32cd32);
    margin-bottom: 4px;
    text-align: left;
}

.day-events {
    flex: 1;
    overflow: hidden;
}

.calendar-event {
    display: block;
    padding: 3px 5px;
    margin-bottom: 2px;
    border-radius: 3px;
    font-size: 0.95rem;
    line-height: 1.3;
    cursor: pointer;
    overflow: hidden;
    white-space: nowrap;
    text-overflow: ellipsis;
    min-height: 20px;
}

.event-dot {
    font-size: 0.7rem;
    margin-right: 3px;
    vertical-align: middle;
}

.event-time {
    font-weight: bold;
    margin-right: 3px;
    font-size: 0.9rem;
}

/* Event Type Colors - Terminal Theme */
.event-general { 
    background-color: rgba(50, 205, 50, 0.2); 
    color: #32cd32;
    border-left: 2px solid #32cd32;
}
.event-deadline { 
    background-color: rgba(255, 69, 0, 0.3); 
    color: #ff4500;
    border-left: 2px solid #ff4500;
}
.event-exam { 
    background-color: rgba(255, 193, 7, 0.3); 
    color: #ffc107;
    border-left: 2px solid #ffc107;
}
.event-holiday { 
    background-color: rgba(0, 255, 127, 0.2); 
    color: #00ff7f;
    border-left: 2px solid #00ff7f;
}
.event-maintenance { 
    background-color: rgba(128, 128, 128, 0.3); 
    color: #808080;
    border-left: 2px solid #808080;
}
.event-meeting { 
    background-color: rgba(0, 191, 255, 0.3); 
    color: #00bfff;
    border-left: 2px solid #00bfff;
}
.event-workshop { 
    background-color: rgba(186, 85, 211, 0.3); 
    color: #ba55d3;
    border-left: 2px solid #ba55d3;
}
.event-announcement { 
    background-color: rgba(255, 255, 255, 0.1); 
    color: #ffffff;
    border-left: 2px solid #ffffff;
}

/* Week View Styles */
.week-view {
    background-color: var(--primary-bg, #000000);
}

.week-table {
    border-collapse: separate !important;
    border-spacing: 0;
    background-color: var(--primary-bg, #000000);
    color: var(--primary-color, #32cd32);
    width: 100%;
}

.week-day-header {
    background-color: var(--secondary-bg, #0f0f0f);
    color: var(--secondary-color, #ffc107);
    border: 1px solid var(--border-color, #32cd32);
    padding: 15px 10px;
    text-align: center;
    vertical-align: middle;
    width: 14.28%;
}

.week-day-title {
    font-weight: bold;
    font-size: 1.1rem;
    margin-bottom: 5px;
}

.week-day-number {
    font-size: 1.3rem;
    font-weight: bold;
    color: var(--primary-color, #32cd32);
}

.week-day-cell {
    height: 400px;
    vertical-align: top;
    padding: 10px;
    border: 1px solid var(--border-color, #32cd32);
    background-color: var(--primary-bg, #000000);
    position: relative;
}

.week-day-cell.today-highlight {
    background-color: var(--secondary-bg, #0f0f0f);
    box-shadow: inset 0 0 5px var(--secondary-color, #ffc107);
}

.week-day-events {
    height: 100%;
    overflow-y: auto;
}

.week-event {
    display: block;
    padding: 8px 10px;
    margin-bottom: 5px;
    border-radius: 4px;
    font-size: 0.9rem;
    line-height: 1.3;
    cursor: pointer;
    border-left: 3px solid;
    word-wrap: break-word;
}

.event-all-day {
    font-weight: bold;
    padding: 3px 0;
}

.event-timed {
    padding: 3px 0;
}

/* Day View Styles */
.day-view {
    background-color: var(--primary-bg, #000000);
}

.all-day-section {
    border-bottom: 2px solid var(--border-color, #32cd32);
    padding: 15px;
    background-color: var(--secondary-bg, #0f0f0f);
}

.all-day-header h6 {
    color: var(--secondary-color, #ffc107);
    margin-bottom: 10px;
    font-weight: bold;
}

.all-day-events {
    display: flex;
    flex-wrap: wrap;
    gap: 10px;
}

.day-table {
    border-collapse: separate !important;
    border-spacing: 0;
    background-color: var(--primary-bg, #000000);
    color: var(--primary-color, #32cd32);
}

.hour-row {
    height: 60px;
    border-bottom: 1px solid var(--border-color, #32cd32);
}

.hour-label {
    width: 100px;
    background-color: var(--secondary-bg, #0f0f0f);
    border-right: 2px solid var(--border-color, #32cd32);
    text-align: center;
    vertical-align: middle;
    font-weight: bold;
    color: var(--secondary-color, #ffc107);
    padding: 10px;
}

.hour-time {
    font-size: 0.9rem;
    font-family: var(--font-family-mono, 'Ubuntu Mono');
}

.hour-events {
    padding: 5px 10px;
    vertical-align: top;
    border-left: 1px solid var(--border-color, #32cd32);
    position: relative;
    background-color: var(--primary-bg, #000000);
}

.day-event {
    display: block;
    padding: 5px 8px;
    margin-bottom: 3px;
    border-radius: 3px;
    font-size: 0.85rem;
    line-height: 1.3;
    cursor: pointer;
    border-left: 3px solid;
    word-wrap: break-word;
    background-color: rgba(50, 205, 50, 0.1);
}

.day-event .event-time {
    font-weight: bold;
    margin-right: 8px;
    color: var(--accent-color, #ffc107);
}

.day-event strong {
    display: block;
    margin-bottom: 2px;
}

.day-event small {
    font-size: 0.75rem;
    opacity: 0.8;
}


/* Poster Indicator Icons */
.poster-indicator {
    color: var(--secondary-color, #ffc107);
    font-size: 0.8em;
    margin-right: 4px;
    opacity: 0.9;
}

.calendar-event .poster-indicator {
    margin-left: 2px;
    margin-right: 2px;
}

.week-event .poster-indicator,
.day-event .poster-indicator {
    margin-right: 6px;
}

/* Zoom Indicator Icons */
.zoom-indicator {
    color: var(--accent-color, #00bcd4);
    font-size: 0.8em;
    margin-right: 4px;
    opacity: 0.9;
}

.calendar-event .zoom-indicator {
    margin-left: 2px;
    margin-right: 2px;
}

.week-event .zoom-indicator,
.day-event .zoom-indicator {
    margin-right: 6px;
}

/* Poster Preview Popup */
.poster-preview-popup {
    display: none;
    background: var(--primary-bg, #000000);
    border: 2px solid var(--border-color, #32cd32);
    border-radius: 8px;
    padding: 4px;
    box-shadow: 0 8px 16px rgba(0, 0, 0, 0.6);
    max-width: 200px;
    pointer-events: none; /* Prevent interfering with hover */
}

.poster-preview-image {
    width: 100%;
    height: auto;
    max-width: 200px;
    max-height: 360px; /* Maintain aspect ratio for portrait */
    border-radius: 4px;
    object-fit: cover;
    background: var(--primary-bg, #000000);
}

/* Event Sidebar Styling */
.event-item {
    border-left: 3px solid var(--secondary-color, #ffc107);
    padding-left: 10px;
}

/* Enhanced hover effects for events with posters */
.calendar-event[data-poster-url]:hover,
.week-event[data-poster-url]:hover,
.day-event[data-poster-url]:hover {
    transform: scale(1.02);
    box-shadow: 0 4px 8px rgba(50, 205, 50, 0.3);
    border-color: var(--secondary-color, #ffc107);
    cursor: pointer;
}

.event-title {
    font-size: 1rem;
}

.event-description {
    font-size: 0.9rem;
    margin-bottom: 0;
}

.badge-urgent { background-color: #dc3545; }
.badge-high { background-color: #fd7e14; }
.badge-normal { background-color: #28a745; }
.badge-low { background-color: #6c757d; }

.text-purple {
    color: #7b1fa2 !important;
}

/* Responsive Design */
/* Large desktop breakpoint - prevent table overflow */
@media (min-width: 1200px) {
    .table-responsive {
        overflow-x: visible;
    }
    
    .container-fluid {
        padding-left: 3rem !important;
        padding-right: 1.5rem !important;
    }
}

/* Medium to large devices - prevent collision zone */
@media (min-width: 992px) and (max-width: 1199px) {
    .calendar-day {
        height: 115px; /* Slightly reduce height */
    }
    
    .calendar-event {
        font-size: 0.9rem; /* Slightly smaller text but still readable */
        padding: 2px 4px;
    }
    
    .day-number {
        font-size: 1.1rem;
    }
    
    /* Ensure table doesn't overflow its container */
    .table-responsive {
        overflow-x: auto;
    }
}

/* Medium devices and below - stack sidebar below calendar */
@media (max-width: 991px) {
    .calendar-table {
        margin-bottom: 15px;
    }
    
    /* Ensure sidebar doesn't overlap */
    .row > [class*="col-"] {
        margin-bottom: 15px;
    }
    
    /* Full width on medium and below */
    .table-responsive {
        overflow-x: auto;
    }
    
    .container-fluid {
        padding-left: 1.5rem !important;
        padding-right: 1rem !important;
    }
}

/* Tablet and smaller devices */
@media (max-width: 768px) {
    .calendar-header th {
        font-size: 1rem;
        padding: 8px 3px;
    }
    
    .calendar-weekday {
        font-size: 1rem;
    }
    
    .calendar-day {
        height: 100px;
    }
    
    .day-number {
        font-size: 1.1rem;
    }
    
    .calendar-event {
        font-size: 0.85rem;
        padding: 2px 3px;
    }
    
    .event-dot {
        font-size: 0.65rem;
    }
    
    /* Reduce calendar table spacing on tablets */
    .table-responsive {
        margin-bottom: 10px;
    }
    
    .container-fluid {
        padding-left: 1rem !important;
        padding-right: 0.5rem !important;
    }
}

@media (max-width: 480px) {
    .calendar-day {
        height: 80px;
    }
    
    .day-number {
        font-size: 1rem;
    }
    
    .calendar-event {
        font-size: 0.8rem;
        padding: 2px 3px;
    }
    
    .calendar-header th {
        padding: 6px 2px;
        font-size: 0.9rem;
    }
    
    .event-dot {
        font-size: 0.6rem;
    }
    
    .container-fluid {
        padding-left: 0.5rem !important;
        padding-right: 0.25rem !important;
    }
    
    /* Week View Mobile */
    .week-day-cell {
        height: 250px;
    }
    
    .week-day-title {
        font-size: 0.9rem;
    }
    
    .week-day-number {
        font-size: 1.1rem;
    }
    
    .week-event {
        font-size: 0.8rem;
        padding: 5px 7px;
    }
    
    /* Day View Mobile */
    .hour-label {
        width: 80px;
        padding: 5px;
    }
    
    .hour-time {
        font-size: 0.8rem;
    }
    
    .day-event {
        font-size: 0.8rem;
        padding: 3px 5px;
    }
    
    .all-day-section {
        padding: 10px;
    }
}

/* Week and Day View Responsive */
@media (max-width: 768px) {
    .week-day-header {
        padding: 10px 5px;
    }
    
    .week-day-cell {
        height: 300px;
        padding: 8px;
    }
    
    .week-event {
        font-size: 0.85rem;
        padding: 6px 8px;
    }
    
    .hour-row {
        height: 50px;
    }
    
    .hour-label {
        width: 90px;
        padding: 8px;
    }
    
    .day-event {
        font-size: 0.8rem;
        padding: 4px 6px;
    }
}
</style>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>
<script>
$(document).ready(function() {
    // Initialize tooltips for calendar events
    $('[data-toggle="tooltip"]').tooltip({
        container: 'body',
        html: true
    });
    
    // Add click functionality to calendar events
    $('.calendar-event').click(function() {
        var eventTitle = $(this).data('title');
        var eventType = $(this).attr('class').match(/event-(\w+)/)[1];
        
        // Show event details in a simple alert (can be enhanced with modal later)
        var detailsHtml = $(this).attr('data-title');
        
        // Create a simple notification instead of alert
        showEventNotification(detailsHtml);
    });
    
    // Function to show event notification
    function showEventNotification(content) {
        // Remove any existing notification
        $('.event-notification').remove();
        
        // Create notification element
        var notification = $('<div class="event-notification alert alert-info alert-dismissible" style="position: fixed; top: 20px; right: 20px; z-index: 9999; max-width: 300px;">' +
            '<button type="button" class="close" data-dismiss="alert">&times;</button>' +
            content +
            '</div>');
        
        // Add to body
        $('body').append(notification);
        
        // Auto-hide after 5 seconds
        setTimeout(function() {
            notification.fadeOut();
        }, 5000);
    }
    
    // Hover functionality for poster previews
    var posterPreviewTimeout;
    
    $('.calendar-event, .week-event, .day-event').hover(
        function() {
            // Mouse enter
            var $this = $(this);
            var posterUrl = $this.data('poster-url');
            
            if (posterUrl && posterUrl !== 'None') {
                clearTimeout(posterPreviewTimeout);
                
                posterPreviewTimeout = setTimeout(function() {
                    showPosterPreview(posterUrl, $this);
                }, 500); // 500ms delay before showing preview
            }
        },
        function() {
            // Mouse leave
            clearTimeout(posterPreviewTimeout);
            hidePosterPreview();
        }
    );
    
    function showPosterPreview(posterUrl, $element) {
        // Remove any existing preview
        $('.poster-preview-popup').remove();
        
        // Get element position
        var offset = $element.offset();
        var elementWidth = $element.outerWidth();
        var elementHeight = $element.outerHeight();
        
        // Create preview popup
        var preview = $('<div class="poster-preview-popup">' +
            '<img src="' + posterUrl + '" alt="Event Poster Preview" class="poster-preview-image">' +
            '</div>');
        
        // Position popup
        var left = offset.left + elementWidth + 10; // 10px to the right
        var top = offset.top;
        
        // Adjust if popup would go off screen
        if (left + 200 > $(window).width()) {
            left = offset.left - 210; // Show to the left instead
        }
        
        preview.css({
            position: 'absolute',
            left: left + 'px',
            top: top + 'px',
            zIndex: 10000
        });
        
        // Add to body
        $('body').append(preview);
        
        // Fade in
        preview.fadeIn(200);
    }
    
    function hidePosterPreview() {
        $('.poster-preview-popup').fadeOut(100, function() {
            $(this).remove();
        });
    }
    
    // Zoom link functionality
    $('.zoom-indicator').click(function(e) {
        e.stopPropagation();
        var $eventDiv = $(this).closest('.calendar-event, .week-event, .day-event');
        var eventTitle = $eventDiv.find('.event-text, strong').first().text().trim();
        
        // Check for zoom URLs in the event data (these would need to be added via data attributes)
        // For now, show notification about Zoom link
        showEventNotification('<strong>Zoom Meeting Available</strong><br>' + 
                            'Event: ' + eventTitle + '<br>' +
                            'Click on event title for full details and Zoom links.');
    });
    
    // Make events with Zoom clickable for joining
    $('.calendar-event, .week-event, .day-event').each(function() {
        var $this = $(this);
        if ($this.find('.zoom-indicator').length > 0) {
            $this.css('cursor', 'pointer');
            $this.attr('title', $this.attr('title') + ' - Click for Zoom details');
        }
    });
    
    // Keyboard navigation
    $(document).keydown(function(e) {
        if (e.ctrlKey || e.metaKey) {
            switch(e.which) {
                case 37: // Ctrl+Left Arrow - Previous month
                    $('.btn:contains("Previous")').click();
                    break;
                case 39: // Ctrl+Right Arrow - Next month
                    $('.btn:contains("Next")').click();
                    break;
                case 84: // Ctrl+T - Today
                    $('.btn:contains("Today")').click();
                    break;
            }
        }
    });
});
</script>
{% endblock %}